      - name: Download BPB worker (release v4.1.0)
        run: |
          curl -fL \
            https://github.com/bia-pain-bache/BPB-Worker-Panel/releases/download/v4.1.0/worker.js \
            -o origin.js

      - name: Verify downloaded file
        run: |
          echo "==== origin.js head ===="
          head -n 5 origin.js
          echo "==== file type ===="
          file origin.js

      - name: Obfuscate BPB
        run: |
          npx javascript-obfuscator origin.js \
            --output _worker.js \
            --compact true \
            --control-flow-flattening true \
            --control-flow-flattening-threshold 1 \
            --dead-code-injection true \
            --dead-code-injection-threshold 1 \
            --string-array true \
            --string-array-encoding base64 \
            --string-array-threshold 1
